<!doctype html><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1">
<title>Veyra — le fait.</title>
<link rel="icon" href="/public/favicon.svg">
<link rel="stylesheet" href="/public/css/globals.css">
<header class="container" style="display:flex;align-items:center;justify-content:space-between;padding:14px 0">
  <a href="/" style="display:flex;gap:10px;align-items:center;color:#E5F3F0;text-decoration:none">
    <img src="/public/logo/veyra_mark_dark.svg" alt="Veyra" width="36" height="36" style="border-radius:12px">
    <strong style="letter-spacing:.2px">Veyra</strong>
  </a>
  <nav style="display:flex;gap:10px;flex-wrap:wrap">
    <a class="btn-ghost" href="/public/app.html">Aujourd’hui</a>
    <a class="btn-ghost" href="/public/proofs.html">Preuves</a>
    <a class="btn-ghost" href="/public/benchmarks.html">Benchmarks</a>
    <a class="btn-ghost" href="/public/status.html">Status</a>
    <a class="btn" href="/export.zip">Export ZIP</a>
  </nav>
</header>

<main class="container" style="padding:20px 0 40px">
  <!-- Hero -->
  <section class="card" style="display:grid;grid-template-columns:1.1fr .9fr;gap:18px;align-items:center">
    <div>
      <span class="badge">Preuve-ou-rien • Local-first</span>
      <h1 style="margin-top:8px;color:var(--veyra-primary);font-family:var(--veyra-font-head)">
        Veyra le fait.<br><span style="color:#E5F3F0">Vous validez. Preuve à l’arrivée.</span>
      </h1>
      <p class="muted" style="margin-top:8px;max-width:52ch">
        1–3 priorités classées. Exécution sous contrôle (N0→N3 + caps). Reçu JSON haché + audit.
      </p>
      <div style="margin-top:12px;display:flex;gap:10px;flex-wrap:wrap">
        <button id="quick" class="btn">Lancer la première</button>
        <a class="btn-ghost" href="/public/app.html">Voir mes priorités</a>
        <a class="btn-ghost" href="/public/proofs.html">Voir une preuve</a>
      </div>
      <div id="quick-status" class="mono muted" style="margin-top:8px"></div>
    </div>

    <!-- Carte “dernière preuve” -->
    <aside class="card" style="background:#0b1020">
      <div style="display:flex;align-items:center;justify-content:space-between">
        <strong>Dernière preuve</strong>
        <a class="btn-ghost" href="/public/proofs.html">Tout voir</a>
      </div>
      <div id="last-proof" class="mono muted" style="margin-top:8px">Chargement…</div>
    </aside>
  </section>

  <!-- Actions rapides -->
  <section class="cards" style="margin-top:16px">
    <div class="card">
      <strong>Exporter mes données</strong>
      <p class="muted">Preuves + audit (zip)</p>
      <a class="btn" href="/export.zip">Exporter ZIP</a>
    </div>
    <div class="card">
      <strong>URL publique</strong>
      <p class="muted"><code id="puburl"></code></p>
      <button class="btn-ghost" onclick="navigator.clipboard.writeText(location.origin);alert('URL copiée')">Copier</button>
    </div>
  </section>
</main>

<script>
const $ = s => document.querySelector(s);

// Remplit l'URL publique
$('#puburl').textContent = location.origin;

// Charge la dernière preuve
async function loadLast(){
  try{
    const r = await fetch('/proofs'); if(!r.ok) throw 0;
    const j = await r.json();
    if(!j.items || !j.items.length){ $('#last-proof').textContent = '— Aucune pour le moment'; return; }
    const p = j.items[0];
    const d = new Date(p.timestamp||Date.now()).toLocaleString();
    const link = `/public/proof.html?id=${encodeURIComponent(p.id)}`;
    const art = (p.artifacts && p.artifacts[0]) ? ` • <a class="btn-ghost" target="_blank" href="${p.artifacts[0]}">Reçu</a>` : '';
    $('#last-proof').innerHTML =
      `<div>${d}</div><div style="font-weight:700">${p.title||p.id}</div>
       <div>id=${p.id} • kind=${p.kind} • sha256=${(p.sha256||'').slice(0,8)}…</div>
       <div style="margin-top:8px"><a class="btn-ghost" href="${link}">Ouvrir dans le viewer</a>${art}</div>`;
  }catch(e){ $('#last-proof').textContent='(erreur de chargement)'; }
}

// Bouton “Lancer la première”
async function quickRun(){
  const s = $('#quick-status'); s.textContent = 'Chargement des priorités…';
  try{
    const r = await fetch('/today?n=1'); const j = await r.json();
    if(!j.priorities || !j.priorities.length){ s.textContent='Rien à faire.'; return; }
    const id = j.priorities[0].id;
    s.textContent = `Exécution: ${id}…`;
    const resp = await fetch('/run',{method:'POST',headers:{'Content-Type':'application/json','Idempotency-Key':String(Math.random()).slice(2,8)},body:JSON.stringify({id})});
    const pr = await resp.json();
    if(pr.ok){
      const url = `/public/proof.html?id=${encodeURIComponent(pr.proof_id)}`;
      s.innerHTML = `✅ Fait. <a class="btn-ghost" href="${url}">Voir la preuve</a>`;
      await loadLast();
    }else{
      s.textContent = 'Échec exécution.';
    }
  }catch(e){ s.textContent='Erreur réseau.'; }
}
$('#quick').addEventListener('click', quickRun);

loadLast();
</script>
